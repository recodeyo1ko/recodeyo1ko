# RailsにおけるCSRF対策とは

## CSRFとは

- Cross Site Request Forgeriesの頭文字をとってCSRF（シーサーフ)
- Webアプリケーションにおける脆弱性の１種
- ざっくりいうと「サイトのログイン状態が保持されている状態で悪意のあるリンクを踏むと、意図しないリクエストを送ってしまう」というもの

- 以下具体例

> 利用者Aがサイトにログインする
- ログインに成功した時点でRailsアプリはAが使ってるブラウザにセッションクッキーを保存する
- このセッションクッキーはそれ以降すべてのHTTPリクエストと一緒に送信される
- Railsはこのセッションクッキーの値を調べることで、ログイン済みかどうかを判断する


> 攻撃者Xが他のサイトに悪意のあるリンクを仕込む
- ユーザー認証はブラウザに保存されているセッションクッキーで突破することを前提


> 利用者Aが攻撃者Xが仕込んだリンクを踏む
- セッションが切れていなければ、アプリ側はログイン済みだと判断する（他のサイトからのリクエストでもセッションクッキーは送信される）
- もしアプリ側でCSRF対策がされていなければそのリクエストは有効なリクエストとして扱われるため、利用者Aが意図しない挙動をしてしまう
- するつもりのない投稿, データの削除, 課金処理 etc,,,

## ActionController :: InvalidAuthenticityTokenのエラーが発生した

```
<%= csrf_meta_tags %> 
```

### 参考サイト

- https://qiita.com/eshow/items/915f8e8ad317aa8e49a6
- https://www.transnet.ne.jp/2016/10/26/%E3%80%8Cruby-on-rails%E3%81%AEcsrf%E5%AF%BE%E7%AD%96colnd/
- https://railsguides.jp/security.html
